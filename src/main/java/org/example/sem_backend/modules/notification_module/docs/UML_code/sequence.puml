@startuml
actor "User Client" as User
participant "Frontend" as FE
participant "Authentication API" as AuthAPI
participant "NotificationController" as NC
participant "NotificationService" as NS
participant "NotificationChannel" as Channel
participant "InAppNotificationChannel" as InApp
participant "SseEmitterService" as SES

== Người Dùng Đăng Nhập và Đăng Ký Nhận Thông Báo ==

User -> FE: Đăng nhập (username, password)
FE -> AuthAPI: POST /api/auth/login
AuthAPI -> FE: Trả về JWT token
FE -> FE: Lưu trữ JWT token
FE -> NC: GET /api/notifications/subscribe?token=JWT
NC -> NS: Xác thực token và đăng ký emitter
NS -> Channel: Gửi thông báo qua kênh
Channel -> InApp: Gửi thông báo qua SSE
InApp -> SES: Gửi thông báo tới emitters
SES -> User: SSE Notification (message)

== Quản trị viên duyệt đơn hàng và gửi thông báo ==

Admin -> OrderController: POST /api/orders/{orderId}/approve
OrderController -> OrderService: approveOrder(orderId)
OrderService -> ApplicationEventPublisher: publish OrderApprovedEvent(orderId, userId)
ApplicationEventPublisher -> NS: OrderApprovedEvent(orderId, userId)
NS -> Channel: send(notification)
Channel -> InApp: send(notification)
InApp -> SES: sendNotification(userId, message)
SES -> User: SSE Notification (message)

@enduml
